# Load necessary packages
library(tidyverse)
library(magrittr)
library(RMySQL)
# Establish connection to database
# This script supposes that you a running a local copy of the database accessible at 'localhost'.
manuscripts <- dbConnect(MySQL(), user="root", dbname="manuscripts", host="localhost")
info_schema <- dbConnect(MySQL(), user="root", dbname="information_schema", host="localhost")
#
# Import main datasets.
super_books <- manuscripts %>%
dbSendQuery("SELECT * FROM manuscript_books") %>%
fetch(n = Inf) %>%
as_tibble()
editions <- manuscripts %>%
dbSendQuery("SELECT * FROM manuscript_books_editions") %>%
fetch(n = Inf) %>%
as_tibble()
illegal_titles <- manuscripts %>%
dbSendQuery("SELECT * FROM manuscript_illegal") %>%
fetch(n = Inf) %>%
as_tibble()
illegal_titles <- manuscripts %>%
dbSendQuery("SELECT * FROM manuscript_titles_illegal") %>%
fetch(n = Inf) %>%
as_tibble()
illegal_titles
# Have a look at the three tables:
super_books
editions
illegal_titles
# Have a look at the three tables:
super_books
editions
illegal_titles
select(illegal_titles, illegal_notes)
editions
illegal_titles
editions
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery("SELECT * FROM manuscript_books_editions") %>%
fetch(n = Inf) %>%
as_tibble() %>%
select(super_book_code, full_book_title, short_book_title, translated_title, stated_publishers,
stated_publication_places, stated_publication_years) # Just keep needed columns
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery("SELECT * FROM manuscript_books_editions") %>%
fetch(n = Inf) %>%
as_tibble() %>%
select(super_book_code, full_book_title, short_book_titles, translated_title, stated_publishers,
stated_publication_places, stated_publication_years) # Just keep needed columns
editions <- manuscripts %>%
dbSendQuery("SELECT * FROM manuscript_books_editions") %>%
fetch(n = Inf) %>%
as_tibble() %>%
select(super_book_code, full_book_title, short_book_titles, translated_title, stated_publishers,
stated_publication_places, stated_publication_years) # Just keep needed columns
illegal_titles <- manuscripts %>%
dbSendQuery("SELECT * FROM manuscript_titles_illegal") %>%
fetch(n = Inf) %>%
as_tibble() %>%
filter(record_status != "DELETED") # filter out deleted records
# Have a look at the two tables:
editions
illegal_titles
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"LEFT JOIN manuscript_books_authors ",
"  ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ",
"LEFT JOIN authors ",
"  ON manuscript_books_authors.author_code = authors.author_code ",
"  AND authors.author_type ='primary'")) %>% # get edition data and author names
fetch(n = Inf) %>%
as_tibble()
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"LEFT JOIN manuscript_books_authors ",
"  ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ",
"LEFT JOIN manuscript_authors ",
"  ON manuscript_books_authors.author_code = manuscript_authors.author_code ",
"  AND manuscript_authors.author_type ='primary'")) %>% # get edition data and author names
fetch(n = Inf) %>%
as_tibble()
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"LEFT JOIN manuscript_books_authors ",
"  ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ",
"LEFT JOIN manuscript_authors ",
"  ON manuscript_books_authors.author_code = manuscript_authors.author_code ",
"  AND manuscript_books_authors.author_type ='primary'")) %>% # get edition data and author names
fetch(n = Inf) %>%
as_tibble()
rm(editions)
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"LEFT JOIN manuscript_books_authors ",
"  ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ",
"LEFT JOIN manuscript_authors ",
"  ON manuscript_books_authors.author_code = manuscript_authors.author_code ",
"  AND manuscript_books_authors.author_type ='primary'")) %>% # get edition data and author names
fetch(n = Inf) %>%
as_tibble()
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"LEFT JOIN manuscript_books_authors ",
"  ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ",
"  AND manuscript_books_authors.author_type ='primary'",
"LEFT JOIN manuscript_authors ",
"  ON manuscript_books_authors.author_code = manuscript_authors.author_code ")) %>% # get edition data and author names
fetch(n = Inf) %>%
as_tibble()
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"INNER JOIN manuscript_books_authors ",
"  ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ",
"LEFT JOIN manuscript_authors ",
"  ON manuscript_books_authors.author_code = manuscript_authors.author_code ")) %>% # get edition data and author names
fetch(n = Inf) %>%
as_tibble()
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"FULL JOIN manuscript_books_authors ",
"  ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ",
"LEFT JOIN manuscript_authors ",
"  ON manuscript_books_authors.author_code = manuscript_authors.author_code ")) %>% # get edition data and author names
fetch(n = Inf) %>%
as_tibble()
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"FULL OUTER JOIN manuscript_books_authors ",
"  ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ",
"LEFT JOIN manuscript_authors ",
"  ON manuscript_books_authors.author_code = manuscript_authors.author_code ")) %>% # get edition data and author names
fetch(n = Inf) %>%
as_tibble()
"  ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ")
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"FULL OUTER JOIN manuscript_books_authors ",
"  ON manuscript_books_editions.book_code = manuscript_books_authors.book_code "))
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"LEFT JOIN manuscript_books_authors ",
"ON manuscript_books_editions.book_code = manuscript_books_authors.book_code "))
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"LEFT JOIN manuscript_books_authors ",
"ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ")) %>%
fetch(n = Inf) %>%
as_tibble()
fetch(n = Inf)
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"LEFT JOIN manuscript_books_authors ",
"ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ")) %>%
fetch(n = Inf) %>%
as_tibble()
dbClearResult(dbListResults(manuscripts)[[1]])
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_editions ",
"LEFT JOIN manuscript_books_authors ",
"ON manuscript_books_editions.book_code = manuscript_books_authors.book_code ")) %>%
fetch(n = Inf) %>%
as_tibble()
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code")) %>%
fetch(n = Inf) %>%
as_tibble()
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code")) %>%
fetch(n = Inf) %>%
as_tibble()
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions ",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code")) %>%
fetch(n = Inf) %>%
as_tibble()
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions ",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code")) %>%
fetch(n = Inf)
colnames(editions)
sum(editions[,1] == editions[,5])
editions[,1] == editions[,5]
(editions[,1] == editions[,5], na.rm = T)
sum(editions[,1] == editions[,5], na.rm = T)
"ON manuscript_books_authors.author_code = manuscript_authors.author_code""))
"ON manuscript_books_authors.author_code = manuscript_authors.author_code))
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions ",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code ",
"LEFT JOIN manuscript_authors ",
"ON manuscript_books_authors.author_code = manuscript_authors.author_code"))
editions
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions ",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code ",
"LEFT JOIN manuscript_authors ",
"ON manuscript_books_authors.author_code = manuscript_authors.author_code")) %>%
fetch(n = Inf)
dbClearResult(dbListResults(manuscripts)[[1]])
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions ",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code ",
"LEFT JOIN manuscript_authors ",
"ON manuscript_books_authors.author_code = manuscript_authors.author_code")) %>%
fetch(n = Inf)
editions
colnames(editions)
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions ",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code ",
"LEFT JOIN manuscript_authors ",
"ON manuscript_books_authors.author_code = manuscript_authors.author_code")) %>%
fetch(n = Inf) %>%
select(-5, -28) %>% # delete duplicate columns generated by the queries.
as_tibble()
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions ",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code ",
"LEFT JOIN manuscript_authors ",
"ON manuscript_books_authors.author_code = manuscript_authors.author_code")) %>%
fetch(n = Inf) %>%
select(-5, -28)
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions ",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code ",
"LEFT JOIN manuscript_authors ",
"ON manuscript_books_authors.author_code = manuscript_authors.author_code")) %>%
fetch(n = Inf) %>%
.[,c(-5,-28)] %>% # delete duplicate columns generated by the queries.
as_tibble()
editions
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions ",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code ",
"LEFT JOIN manuscript_authors ",
"ON manuscript_books_authors.author_code = manuscript_authors.author_code")) %>%
fetch(n = Inf) %>%
.[,c(-5,-28)] %>% # delete duplicate columns generated by the queries.
as_tibble() %>% # convert to tibble for easier manipulation
select(super_book_code, full_book_title, short_book_titles, translated_title,
stated_publishers, stated_publication_places, stated_publication_years,
author_name) # only keep necessary columns
illegal_titles <- manuscripts %>%
dbSendQuery("SELECT * FROM manuscript_titles_illegal") %>%
fetch(n = Inf) %>%
as_tibble() %>%
filter(record_status != "DELETED") # filter out deleted records
# Have a look at the two tables:
editions
illegal_titles
illegal_titles <- manuscripts %>%
dbSendQuery("SELECT * FROM manuscript_titles_illegal") %>%
fetch(n = Inf) %>%
as_tibble() %>%
filter(record_status != "DELETED") # filter out deleted records
# First clean up the illegal_titles table.
illegal_titles
select(illegal_titles, bastille_imprint_full)
select(illegal_titles, bastille_imprint_full) %>%
filter(nchar(bastille_imprint_full) > 0)
illegal_titles %>%
filter(nchar(bastille_imprint_full) > 1, nchar(illegal_notes) > 1)
# Import main datasets.
editions <- manuscripts %>%
dbSendQuery(paste0("SELECT * FROM manuscript_books_authors ",
"LEFT JOIN manuscript_books_editions ",
"ON manuscript_books_authors.book_code = manuscript_books_editions.book_code ",
"LEFT JOIN manuscript_authors ",
"ON manuscript_books_authors.author_code = manuscript_authors.author_code")) %>%
fetch(n = Inf) %>%
.[,c(-5,-28)] %>% # delete duplicate columns generated by the queries.
as_tibble() %>% # convert to tibble for easier manipulation
select(super_book_code, full_book_title, short_book_titles, translated_title,
stated_publishers, stated_publication_places, stated_publication_years,
author_name, author_code) # only keep necessary columns
# First clean up the illegal_titles table.
illegal_titles %<>%
mutate(bastille_imprint_full = gsub("Published in", "", bastille_imprint_full))
select(illegal_titles, bastille_imprint_full) %>% filter(nchar(bastille_imprint_full) > 1)
# First clean up the illegal_titles table.
illegal_titles %<>%
mutate(bastille_imprint_full = gsub("Published in", "", bastille_imprint_full),
bastille_imprint_full = gsub(", publisher not identified", "", bastille_imprint_full),
bastille_imprint_full = str_squish(bastille_imprint_full))
select(illegal_titles, bastille_imprint_full) %>% filter(nchar(bastille_imprint_full) > 1)
select(illegal_titles, bastille_imprint_full) %>% filter(nchar(bastille_imprint_full) > 1) %>% print(n = 50)
